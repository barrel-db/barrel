%% -*- mode: erlang;erlang-indent-level: 2;indent-tabs-mode: nil -*-
%% ex: ts=4 sw=4 ft=erlang et

%% == Erlang Compiler ==

{minimum_otp_vsn, "21.2"}.

{erl_opts, [
  warn_unused_vars,
  warnings_as_errors,
  warn_export_all,
  warn_shadow_vars,
  warn_unused_import,
  warn_unused_function,
  warn_bif_clash,
  warn_unused_record,
  warn_deprecated_function,
  warn_obsolete_guard,
  strict_validation,
  warn_export_vars,
  warn_exported_vars,
%%  warn_missing_spec,
%%  warn_untyped_record,
  debug_info,
  {erl_opts, [{parse_transform, oc_transform}]}
]}.

%% == Dependencies ==

{deps, [
  {erlang_term, "1.7.4"},
  %% uuid lib
  {uuid, {pkg, uuid_erl}},
  {jobs, "0.9.0"},
  {gproc, "0.8.0"},
  {worker_pool, "4.0.0"},
  {hooks, "2.0.1"},
  {ehash, "0.2.1"},
  {recon, "2.4.0"},

  {rocksdb, "1.1.1"},

  {gen_batch_server,
   {git, "https://github.com/rabbitmq/gen-batch-server.git",
    {ref, "b7cf2f9a9916d05ad93f341b70809caf0de8d551"}}},

  {partisan,
   {git, "https://github.com/benoitc/partisan.git",
    {ref, "5e669f541eaa6c4cc26cd2f5f462e05675756cce"}}},

  {opencensus, "~> 0.9.1"},
  {mimerl, "~> 1.2"},
  {lru, "2.4.0"}

]}.

{shell, [
    {config, "config/test.config"},
    {apps, [barrel]}
]}.

{eunit_opts, [{dir, "src"}]}.


%% == Release ==

{relx, [
  {release,
    {'barrel', "0.10.0"},
    [ barrel]
  },
  {sys_config, "config/sys.config"},
  {dev_mode, true},
  {include_erts, false},
  {include_src, false},
  {extended_start_script, true}
]}.

%% == Profiles ==

{profiles,
  [{prod,
    [{relx,
      [{sys_config, "./config/sys.config"},
        {vm_args, "config/vm.args"},
        {dev_mode, false},
        {include_erts, true},
        {extended_start_script, true},
        {include_src, false},
        {extended_start_script, true}
      ]}
    ]}
  ]}.


%% == Common Test ==

{ct_compile_opts, [
  warn_unused_vars,
  warn_export_all,
  warn_shadow_vars,
  warn_unused_import,
  warn_unused_function,
  warn_bif_clash,
  warn_unused_record,
  warn_deprecated_function,
  warn_obsolete_guard,
  strict_validation,
  warn_export_vars,
  warn_exported_vars,
  %%warn_missing_spec,
  %%warn_untyped_record,
  debug_info
]}.

{ct_opts, [
  {sys_config, ["config/sys.config"]}
]}.


%% == Cover ==

{cover_enabled, true}.

{cover_opts, [verbose]}.

%% == Dialyzer ==
%%
{dialyzer, [
  {warnings, [
    no_missing_calls,
    race_conditions,
    no_return,
    unmatched_returns,
    error_handling%,
    %unknown
  ]},
  {plt_apps, top_level_deps},
  {plt_extra_apps, []},
  {plt_location, local},
  {plt_prefix, "barrel"},
  {base_plt_location, "."},
  {base_plt_prefix, "barrel"}
]}.


{xref_checks, [undefined_function_calls, undefined_functions,
               deprecated_function_calls, deprecated_functions]}.
